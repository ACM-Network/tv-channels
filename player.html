<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACM Network</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ACM Network</h1>
    </header>

    <main>
        <div id="playerContainer">
            <video controls crossorigin playsinline id="player">
                <source src="" type="application/x-mpegURL">
            </video>
            <div class="custom-controls">
                <button id="play-pause" class="control-btn"><span id="play-icon">‚ñ∫</span><span id="pause-icon">‚ùö‚ùö</span></button>
                <span id="live-indicator">‚Ä¢ LIVE</span>
                <input type="range" id="progress-bar" value="0" min="0" max="100">
                <button id="mute-unmute" class="control-btn"><span id="mute-icon">üîà</span><span id="unmute-icon">üîá</span></button>
                <button id="pip" class="control-btn">PIP</button>
                <button id="fullscreen" class="control-btn">‚§¢</button>
            </div>
        </div>
    </main>

    <footer>
        <p>ACM Network &copy; 2024</p>
    </footer>

    <script src="https://cdn.plyr.io/3.6.8/plyr.polyfilled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const streamUrl = urlParams.get('url');
        const videoElement = document.getElementById('player');

        if (streamUrl) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(streamUrl);
                hls.attachMedia(videoElement);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    videoElement.play();
                });
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = streamUrl;
                videoElement.addEventListener('loadedmetadata', function() {
                    videoElement.play();
                });
            } else {
                videoElement.src = streamUrl;
                videoElement.addEventListener('loadedmetadata', function() {
                    videoElement.play();
                });
            }
        }

        const player = new Plyr(videoElement, {
            controls: [],
            tooltips: { controls: false, seek: true },
            displayDuration: false // Hide duration display
        });

        player.on('playing', () => {
            console.log('Video is playing');
        });

        player.on('waiting', () => {
            console.log('Buffering...');
        });

        // Custom Controls
        const playPauseButton = document.getElementById('play-pause');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const muteUnmuteButton = document.getElementById('mute-unmute');
        const muteIcon = document.getElementById('mute-icon');
        const unmuteIcon = document.getElementById('unmute-icon');
        const pipButton = document.getElementById('pip');
        const fullscreenButton = document.getElementById('fullscreen');
        const progressBar = document.getElementById('progress-bar');

        playPauseButton.addEventListener('click', () => {
            if (videoElement.paused || videoElement.ended) {
                videoElement.play();
            } else {
                videoElement.pause();
            }
            updatePlayPauseIcon();
        });

        videoElement.addEventListener('play', updatePlayPauseIcon);
        videoElement.addEventListener('pause', updatePlayPauseIcon);

        function updatePlayPauseIcon() {
            if (videoElement.paused || videoElement.ended) {
                playIcon.style.display = 'inline';
                pauseIcon.style.display = 'none';
            } else {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline';
            }
        }

        muteUnmuteButton.addEventListener('click', () => {
            videoElement.muted = !videoElement.muted;
            updateMuteUnmuteIcon();
        });

        function updateMuteUnmuteIcon() {
            if (videoElement.muted) {
                muteIcon.style.display = 'none';
                unmuteIcon.style.display = 'inline';
            } else {
                muteIcon.style.display = 'inline';
                unmuteIcon.style.display = 'none';
            }
        }

        pipButton.addEventListener('click', async () => {
            if (videoElement !== document.pictureInPictureElement) {
                try {
                    await videoElement.requestPictureInPicture();
                } catch (error) {
                    console.error(error);
                }
            } else {
                await document.exitPictureInPicture();
            }
        });

        fullscreenButton.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                videoElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        });

        videoElement.addEventListener('timeupdate', updateProgressBar);

        function updateProgressBar() {
            progressBar.value = (videoElement.currentTime / videoElement.duration) * 100;
        }

        progressBar.addEventListener('input', () => {
            videoElement.currentTime = (progressBar.value / 100) * videoElement.duration;
        });
    </script>
</body>
</html>
